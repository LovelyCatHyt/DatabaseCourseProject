<Window x:Class="StudentManageSystem.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:StudentManageSystem"
        mc:Ignorable="d"
        Title="MainWindow" Height="600" Width="1200" HorizontalContentAlignment="Left">
    <Window.Resources>
        <CollectionViewSource x:Key="studentViewSource"/>
        <CollectionViewSource x:Key="classViewSource"/>
        <CollectionViewSource x:Key="departmentViewSource"/>
        <CollectionViewSource x:Key="majorViewSource"/>
        <CollectionViewSource x:Key="courseViewSource"/>
        <CollectionViewSource x:Key="courseSelectionViewSource"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="3*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="4*"/>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>
        <!--Â≠¶ÁîüË°®-->
        <DataGrid x:Name="studentsDataGrid" AutoGenerateColumns="False" 
                  Grid.Row="0"
                  Grid.Column="0"
                  EnableRowVirtualization="False" 
                  ItemsSource="{Binding Source={StaticResource studentViewSource}}" 
                  Margin="5,5,5,5"
                  RowDetailsVisibilityMode="VisibleWhenSelected"
                  CanUserAddRows="False" CurrentCellChanged="DataGridCellChanged" MouseDown="DataGridMouseDown"
                  SelectedItem="{Binding ElementName=studentQueryResult, Path=SelectedItem, Mode=OneWay}">
            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Id, UpdateSourceTrigger=PropertyChanged}" Header="Â≠¶Âè∑" 
                                    Width="Auto"
                                    IsReadOnly="True"/>
                <DataGridTextColumn Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Header="ÂßìÂêç" 
                                    Width="Auto"/>
                <DataGridTemplateColumn x:Name="studentBirth" Header="Âá∫ÁîüÊó•Êúü"
                                    Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <DatePicker SelectedDate="{Binding Birth, UpdateSourceTrigger=PropertyChanged}" BorderThickness="0" SelectedDateChanged="DatePicker_OnSelectedDateChanged"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridComboBoxColumn x:Name="studentGender" Header="ÊÄßÂà´" SelectedValueBinding="{Binding Gender, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="Auto"/>
                <DataGridComboBoxColumn x:Name="studentClass" Header="Áè≠Á∫ß" SelectedValueBinding="{Binding ClassId,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                    Width="Auto"/>
            </DataGrid.Columns>
        </DataGrid>
        <StackPanel Grid.Column="0" Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5">
            <Button x:Name="AddStudentButton" Content="+" Click="AddStudent"
                HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
            <Button x:Name="RemoveStudentButton" Content="-" Click="RemoveStudent"
                HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
        </StackPanel>
        <GridSplitter Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                      ResizeDirection="Columns" ResizeBehavior="CurrentAndNext" Width="5" HorizontalAlignment="Right" />
        <!--Áè≠Á∫ßË°®-->
        <DataGrid x:Name="classDataGrid" Grid.Row="0" Grid.Column="1" Margin="0,5,5,5" AutoGenerateColumns="False"
                  EnableRowVirtualization="False" EnableColumnVirtualization="False"
                  RowDetailsVisibilityMode="VisibleWhenSelected" CanUserAddRows="False"
                  ItemsSource="{Binding Source={StaticResource classViewSource}}"
                  CurrentCellChanged="DataGridCellChanged"
                  MouseDown="DataGridMouseDown">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Áè≠Á∫ßÂè∑" Width="Auto" Binding="{Binding ClassId}" IsReadOnly="True"/>
                <DataGridComboBoxColumn x:Name="classDepartmentName" Header="Èô¢Á≥ª" Width="Auto" SelectedValueBinding="{Binding DepartmentName}" />
                <DataGridComboBoxColumn x:Name="ClassMajorName" Header="‰∏ì‰∏ö" Width="Auto" SelectedValueBinding="{Binding MajorName}">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource" Value="{Binding MajorNames}"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style TargetType="ComboBox">
                            <Setter Property="ItemsSource" Value="{Binding MajorNames}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>
            </DataGrid.Columns>
        </DataGrid>
        <StackPanel Grid.Column="1" Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5">
            <Button x:Name="AddClassButton" Content="+" Click="AddClass"
                    HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
            <Button x:Name="RemoveClassButton" Content="-" Click="RemoveClass"
                    HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
        </StackPanel>
        <GridSplitter Grid.Row="0" Grid.RowSpan="2" Grid.Column="1"
                      ResizeDirection="Columns" ResizeBehavior="CurrentAndNext" Width="5" HorizontalAlignment="Right"/>
        <Grid Grid.Row="0" Grid.Column="2" Grid.RowSpan="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="5*"></RowDefinition>
                <RowDefinition Height="1*"></RowDefinition>
                <RowDefinition Height="5*"></RowDefinition>
                <RowDefinition Height="1*"></RowDefinition>
            </Grid.RowDefinitions>
            <!--Èô¢Á≥ªË°®-->
            <DataGrid x:Name="departmentDataGrid" Grid.Row="0" Grid.Column="0" Margin="0,5" AutoGenerateColumns="False"
                      EnableRowVirtualization="False" EnableColumnVirtualization="False"
                      RowDetailsVisibilityMode="VisibleWhenSelected" CanUserAddRows="False"
                      ItemsSource="{Binding Source={StaticResource departmentViewSource}}"
                      CurrentCellChanged="DataGridCellChanged"
                      MouseDown="DataGridMouseDown">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Èô¢Á≥ªÂè∑" Width="Auto" Binding="{Binding DepartmentId}"></DataGridTextColumn>
                    <DataGridTextColumn Header="Èô¢Á≥ªÂêçÁß∞" Width="Auto" Binding="{Binding Name}"></DataGridTextColumn>
                    <DataGridTextColumn Header="Èô¢Á≥ªÁ±ªÂà´" Width="Auto" Binding="{Binding DepartmentType}"></DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0, 5">
                <Button x:Name="AddDepartmentButton" Content="+" Click="AddDepartment"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
                <Button x:Name="RemoveDepartmentButton" Content="-" Click="RemoveDepartment"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
            </StackPanel>
            <GridSplitter Grid.Row="1" ResizeDirection="Rows" ResizeBehavior="PreviousAndNext" 
                          Height="5" VerticalAlignment="Bottom"
                          HorizontalAlignment="Stretch"/>
            <!--‰∏ì‰∏öË°®-->
            <DataGrid x:Name="majorGrid" Grid.Row="2" Margin="0,5" AutoGenerateColumns="False"
                      EnableRowVirtualization="False" EnableColumnVirtualization="False"
                      RowDetailsVisibilityMode="VisibleWhenSelected" CanUserAddRows="False"
                      ItemsSource="{Binding Source={StaticResource majorViewSource}}"
                      CurrentCellChanged="DataGridCellChanged"
                      MouseDown="DataGridMouseDown">
                <DataGrid.Columns>
                    <!--Áî±‰∫éÂÆåÊï¥ÊÄßÁ∫¶Êùü, Ëøô‰∏§‰∏™Â±ûÊÄßÁöÑ‰øÆÊîπÈùûÂ∏∏È∫ªÁÉ¶, Âõ†Ê≠§ÁõÆÂâç‰∏çÁªô‰øÆÊîπ-->
                    <DataGridTextColumn IsReadOnly="True" Header="Èô¢Á≥ª" Width="Auto" Binding="{Binding DepartmentName}"/>
                    <DataGridTextColumn IsReadOnly="True" Header="‰∏ì‰∏öÂêçÂ≠ó" Width="Auto" Binding="{Binding MajorName}"/>
                </DataGrid.Columns>
            </DataGrid>
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,5,5,5">
                <Button x:Name="AddMajorButton" Content="+" Click="AddMajor"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
                <Button x:Name="RemoveMajorButton" Content="-" Click="RemoveMajor"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
            </StackPanel>
        </Grid>
        <GridSplitter Grid.Row="0" Grid.RowSpan="2" Grid.Column="3"
                      ResizeDirection="Columns" ResizeBehavior="PreviousAndCurrent" Width="5" HorizontalAlignment="Left"/>
        <Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="3" Margin="5,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="5*"></RowDefinition>
                <RowDefinition Height="1*"></RowDefinition>
                <RowDefinition Height="5*"></RowDefinition>
                <RowDefinition Height="1*"></RowDefinition>
            </Grid.RowDefinitions>
            <!--ÂèØÈÄâËØæÁ®ãË°®-->
            <DataGrid x:Name="courseDataGrid" Grid.Row="0" Grid.Column="0" Margin="0,5" AutoGenerateColumns="False"
                      EnableRowVirtualization="False" EnableColumnVirtualization="False"
                      RowDetailsVisibilityMode="VisibleWhenSelected" CanUserAddRows="False"
                      ItemsSource="{Binding Source={StaticResource courseViewSource}}"
                      CurrentCellChanged="DataGridCellChanged"
                      MouseDown="DataGridMouseDown">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ËØæÁ®ãÁºñÂè∑" Width="Auto" Binding="{Binding Id}" IsReadOnly="True"></DataGridTextColumn>
                    <DataGridTextColumn Header="ËØæÁ®ãÂêçÁß∞" Width="Auto" Binding="{Binding Name}"></DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0, 5">
                <Button Content="+" Click="AddCourse"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
                <Button Content="-" Click="RemoveCourse"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
            </StackPanel>
            <GridSplitter Grid.Row="1" ResizeDirection="Rows" ResizeBehavior="PreviousAndNext" 
                          Height="5" VerticalAlignment="Bottom"
                          HorizontalAlignment="Stretch"/>
            <!--ÈÄâËØæË°®-->
            <DataGrid x:Name="courseSelectionGrid" Grid.Row="2" Margin="0,5" AutoGenerateColumns="False"
                      EnableRowVirtualization="False" EnableColumnVirtualization="False"
                      RowDetailsVisibilityMode="VisibleWhenSelected" CanUserAddRows="False"
                      ItemsSource="{Binding Source={StaticResource courseSelectionViewSource}}"
                      CurrentCellChanged="DataGridCellChanged"
                      MouseDown="DataGridMouseDown">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ÈÄâËØæÁºñÂè∑" Width="Auto" Binding="{Binding Id}" IsReadOnly="True"></DataGridTextColumn>
                    <DataGridTextColumn Header="Â≠¶Âè∑" Width="Auto" Binding="{Binding StudentId}" IsReadOnly="True"></DataGridTextColumn>
                    <DataGridComboBoxColumn Header="ËØæÁ®ãÂè∑" Width="Auto" SelectedValueBinding="{Binding SelectedCourse}">
                        <DataGridComboBoxColumn.ElementStyle>
                            <Style TargetType="ComboBox">
                                <Setter Property="ItemsSource" Value="{Binding AvailableCourses}"/>
                            </Style>
                        </DataGridComboBoxColumn.ElementStyle>
                        <DataGridComboBoxColumn.EditingElementStyle>
                            <Style TargetType="ComboBox">
                                <Setter Property="ItemsSource" Value="{Binding AvailableCourses}"/>
                            </Style>
                        </DataGridComboBoxColumn.EditingElementStyle>
                    </DataGridComboBoxColumn>

                </DataGrid.Columns>
            </DataGrid>
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,5,5,5">
                <Button Content="+" Click="AddCourseSelection"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
                <Button Content="-" Click="RemoveCourseSelection"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Height="30" Width="30" />
            </StackPanel>
        </Grid>
        <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4" BorderBrush="Gray" BorderThickness="2">
            <StackPanel Orientation="Horizontal" Margin="5" HorizontalAlignment="Center">
                <Button x:Name="RevertAllButton" Content="ÈáçÁΩÆ‚Ü∫" Click="RevertAll"
                        Height="30" Width="40"/>
                <Button x:Name="SaveChangesButton" Content="‰øùÂ≠òüíæ" Click="SaveChanges"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Width="160" Height="30"/>
                <Button Content="Êü•ËØ¢üîç" Click="ToggleQuery"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Width="40" Height="30"></Button>
            </StackPanel>
        </Border>
        <Border Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="4" BorderThickness="5" BorderBrush="Wheat">
            <TextBlock x:Name="ErrorMsg" Text="" />
        </Border>
        <Grid x:Name="queryGrid" Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"></RowDefinition>
                <RowDefinition Height="Auto"></RowDefinition>
            </Grid.RowDefinitions>
            <StackPanel  Orientation="Horizontal" 
                         Width="Auto" Height="Auto" Margin="5" VerticalAlignment="Center">
                <CheckBox x:Name="studentNameChkBox" Content="ÂßìÂêç" Margin="5,3,1.5,3" VerticalAlignment="Center"/>
                <TextBox x:Name="studentNameQueryTxt" Width="100" VerticalAlignment="Center" IsEnabled="{Binding ElementName=studentNameChkBox, Path=IsChecked}"/>
                <CheckBox x:Name="studentIdChkBox" Content="Â≠¶Âè∑" Margin="5,3,1.5,3" VerticalAlignment="Center"/>
                <TextBox x:Name="studentIdQueryTxt" Width="120" VerticalAlignment="Center" IsEnabled="{Binding ElementName=studentIdChkBox, Path=IsChecked}"/>
                <CheckBox x:Name="studentMajorChkBox" Content="‰∏ì‰∏ö" Margin="5,3,1.5,3" VerticalAlignment="Center"/>
                <TextBox x:Name="studentMajorQueryTxt" Width="120" VerticalAlignment="Center" IsEnabled="{Binding ElementName=studentMajorChkBox, Path=IsChecked}"/>
                <CheckBox x:Name="studentDepartmentChkBox" Content="Èô¢Á≥ª" Margin="5,3,1.5,3" VerticalAlignment="Center"/>
                <TextBox x:Name="studentDepartmentQueryTxt" Width="120" VerticalAlignment="Center" IsEnabled="{Binding ElementName=studentDepartmentChkBox, Path=IsChecked}"/>
                <Button Click="RunQuery" Content="Êü•ËØ¢"/>
            </StackPanel>
            <DataGrid Grid.Row="1" x:Name="studentQueryResult" AutoGenerateColumns="False" Margin="5">
                <DataGrid.Columns>
                    <DataGridTextColumn Binding="{Binding Id, UpdateSourceTrigger=PropertyChanged}" Header="Â≠¶Âè∑" IsReadOnly="True"
                                        Width="Auto"/>
                    <DataGridTextColumn Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Header="ÂßìÂêç" IsReadOnly="True"
                                        Width="Auto"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
        <GridSplitter Grid.Row="0" Grid.RowSpan="5" Grid.Column="4"
                      ResizeDirection="Columns" ResizeBehavior="PreviousAndCurrent" Width="5" HorizontalAlignment="Left"/>
        <GroupBox Grid.Row="0" Grid.RowSpan="5" Grid.Column="4" Margin="5,5" Width="Auto" Header="SqlËØ≠Âè•">
            <ListBox x:Name="sqlList"/>
        </GroupBox>
        <Button Grid.Row="0" Grid.RowSpan="5" Grid.Column="4"
                HorizontalAlignment="Right" VerticalAlignment="Bottom"
                Width="Auto" Height="Auto" Margin="11"
                Click="ClearSqlViewer"
                >üóëÔ∏è</Button>
    </Grid>
</Window>
